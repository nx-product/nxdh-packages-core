<?xml version='1.0' encoding="UTF-8" ?>
<HEAD>
<PACKAGE>DHRD-103267_MANDATORY_7_1</PACKAGE>
<NAME>DHRD-103267_MANDATORY_7_1</NAME>
<BUILD_DATE>20250204</BUILD_DATE>
<LEVEL>MANDATORY</LEVEL>
<ORIGIN></ORIGIN>
<RELEASE></RELEASE>
<CREATOR>NeoXam</CREATOR>
<DESCRIPTION><![CDATA[to allow the S3 listerer task to write in an authorized folder]]></DESCRIPTION>
</HEAD>

<BODY>
<!--   Package created by NeoXam -->
<!--      creation date: 04/02/2025 18:58:16 -->
<!--      creation version: null -->
<!--      source environment: //nx-dh-refprod-cluster1.bams.corp:8100/SmartServer -->

<!--MxScheduledTask 126940 v24 [Current version] -->
<RESULT MODE="XML" ACTION="GETOBJECTS"  VERSION="2"  CHARSET="UTF8" >
<SCHEDTASK FIND="TASK_CODE='IMP_DIRECTORY_LISTENER_AWS'" USER="NeoXam" UPDATE_DATE="04/02/2025" UPDATE_TIME="18:51:04" LABEL='IMP_DIRECTORY_LISTENER_AWS' PARTIAL='1'>
<T_SCHEDTASK CODEFIELDS="TASK_CODE" >
</T_SCHEDTASK>
<T_SCHEDTASK_JOB CODEFIELDS="JOB_CODE" >
<R_SCHEDTASK_JOB CODE=",[&quot;JOB_CODE&quot;,&quot;1&quot;,]"  LOCAL_ID="154735" >
<SERVICE_ARGS ><![CDATA[SYNC_LOCAL_REPO %S3DIR% /nxdh/s3listener]]></SERVICE_ARGS>
</R_SCHEDTASK_JOB>
<R_SCHEDTASK_JOB CODE=",[&quot;JOB_CODE&quot;,&quot;2&quot;,]"  LOCAL_ID="154733" >
<SERVICE_ARGS ><![CDATA[ACTION=GETOBJECT BUCKET_NAME=%BUCKET_NAME% KEY=%KEY% CHANNELCODE=%CHANNELCODE% DIR=%S3DIR% FILENAME=%FILENAME%]]></SERVICE_ARGS>
</R_SCHEDTASK_JOB>
<R_SCHEDTASK_JOB CODE=",[&quot;JOB_CODE&quot;,&quot;3&quot;,]"  LOCAL_ID="154732" >
<SERVICE_ARGS ><![CDATA[ACTION=DELETEOBJECT BUCKET_NAME=%BUCKET_NAME% KEY=%KEY% CHANNELCODE=%CHANNELCODE% DIR=%S3DIR% FILENAME=%FILENAME%]]></SERVICE_ARGS>
</R_SCHEDTASK_JOB>
<R_SCHEDTASK_JOB CODE=",[&quot;JOB_CODE&quot;,&quot;4&quot;,]"  LOCAL_ID="154736" >
<SERVICE_ARGS ><![CDATA[ACTION=GETOBJECT BUCKET_NAME=<bucket_name> KEY=6.csv REGION=eu-west-3 CHANNELCODE=AWS_CRED_S3 DIR=%S3DIR% FILENAME=5.csv]]></SERVICE_ARGS>
</R_SCHEDTASK_JOB>
<R_SCHEDTASK_JOB CODE=",[&quot;JOB_CODE&quot;,&quot;5&quot;,]"  LOCAL_ID="157732" >
<SERVICE_ARGS ><![CDATA[ACTION=GETOBJECT BUCKET_NAME=<bucket_name> KEY=5.txt REGION=eu-west-3 CHANNELCODE=AWS_CRED_S3_VIA_HTTP DIR=%S3DIR% FILENAME=5.txt ROLE_ARN=<role_arn> ROLE_SESSION_NAME=<name>]]></SERVICE_ARGS>
</R_SCHEDTASK_JOB>
<R_SCHEDTASK_JOB CODE=",[&quot;JOB_CODE&quot;,&quot;6&quot;,]"  LOCAL_ID="157734" >
<SERVICE_ARGS ><![CDATA[ACTION=DELETEOBJECT BUCKET_NAME=<bucket_name> KEY=5.txt REGION=eu-west-3 CHANNELCODE=AWS_CRED_S3_VIA_HTTP DIR=%S3DIR% FILENAME=5.txt ROLE_ARN=<role_arn> ROLE_SESSION_NAME=name]]></SERVICE_ARGS>
</R_SCHEDTASK_JOB>
</T_SCHEDTASK_JOB>
<T_SCHEDTASK_JOB_NAME CODEFIELDS="LANGUAGE^JOB_ID" >
</T_SCHEDTASK_JOB_NAME>
<T_SCHEDTASK_NAME CODEFIELDS="TASK_LANGUAGE" >
</T_SCHEDTASK_NAME>
<T_SCHEDTASK_PREREQUISITE>
</T_SCHEDTASK_PREREQUISITE>
<T_SCHEDTASK_TRANSITION CODEFIELDS="PREV_JOB_CODE^EXCEPTION_TYPE" >
</T_SCHEDTASK_TRANSITION>
<T_SCHEDTASK_TRIGGER>
</T_SCHEDTASK_TRIGGER>

</SCHEDTASK>
</RESULT>

<!--MxRule 160204 v2 [Current version] -->
<RESULT MODE="XML" ACTION="GETOBJECTS"  VERSION="2"  CHARSET="UTF8" >
<SMARTRULE FIND="RULE_CODE='SYNC_LOCAL_REPO'" USER="NeoXam" UPDATE_DATE="04/02/2025" UPDATE_TIME="18:52:07" LABEL='Sync S3 Folder With Local Repo' PARTIAL='1'>
<T_SMARTRULE CODEFIELDS="RULE_CODE" >
<R_SMARTRULE CODE=",[&quot;RULE_CODE&quot;,&quot;SYNC_LOCAL_REPO&quot;,]"  LOCAL_ID="160204" >
<IMPACT ><![CDATA[//SCHEDTASK_EXEC
s3dir:=arg1;
localDir:=arg2;

if (s3dir = ".")
  return localDir;
vals := strtokenize(s3dir,"/");
folder:="";
for (i:=0; i<arraysize(vals); i := i + 1)
{
   if (i=0)
     folder := vals[i];
   else
     folder := folder + "/" + vals[i];

   folder := localDir + "/" + folder;
   if (doesfileexists(folder) != 1)
   {
      createFolder(""+folder);
      msgtrace("Folder " + folder + " created");
   }
}
return "OK";]]></IMPACT>
</R_SMARTRULE>
</T_SMARTRULE>
<T_SMARTRULE_NAME CODEFIELDS="NAME_LANGUAGE" >
</T_SMARTRULE_NAME>
<T_SMARTRULE_TRIGGER CODEFIELDS="TRIGGER_TYPE^TRIGGER_OBJECT" >
</T_SMARTRULE_TRIGGER>
<T_SMARTRULE_WFLINK>
</T_SMARTRULE_WFLINK>

</SMARTRULE>
</RESULT>

</BODY>
